# ğŸ”¥ `HAVING`--

## ğŸ”· What is `HAVING`?

* `HAVING` is a SQL clause used to **filter grouped results**.
* It always works **with `GROUP BY`**.
* It filters data **after aggregation**, unlike `WHERE`, which filters **before**.

Think of it like:

> "Group the data, calculate things like average or count, then show only the groups I care about."

---

## ğŸ§  Why Do We Need `HAVING`?

* You **canâ€™t** use aggregate functions (like `AVG()`, `SUM()`, `COUNT()`) inside `WHERE`.
* So when you need to **filter by aggregates**, you must use `HAVING`.

âœ… `HAVING` â†’ to filter **groups**
âŒ `WHERE` â†’ can't be used to filter based on group summaries

---

## âš™ï¸ How `HAVING` Works (Step-by-Step)

Hereâ€™s how SQL runs your query (in logical order):

1. **`FROM`** â€” Pick the table
2. **`WHERE`** â€” Filter individual rows
3. **`GROUP BY`** â€” Group the remaining rows
4. **Aggregate Functions** â€” Calculate `COUNT`, `AVG`, etc.
5. **`HAVING`** â€” Filter those group results
6. **`SELECT`** â€” Choose what to return
7. **`ORDER BY`** â€” Sort the final result

---

## ğŸ“Œ When to Use `HAVING`

Use `HAVING` if:

* You're using `GROUP BY`
* You want to filter **after aggregation**
* You need questions like:

  * â€œWhich departments have more than 5 employees?â€
  * â€œWhich cities have an average score above 80?â€
  * â€œWhich products were sold more than 100 times?â€

---

## âœ… Syntax Pattern

```sql
SELECT column, AGG_FUNC(column2)
FROM table
WHERE condition            -- (optional) filter rows first
GROUP BY column
HAVING aggregate_condition -- filter grouped results
ORDER BY column;
```

---

## ğŸ” Examples 

**1. Count students per city, but only cities with more than 2 students:**

```sql
SELECT city, COUNT(*) AS student_count
FROM students
GROUP BY city
HAVING COUNT(*) > 2;
```

**2. Show grades with average marks above 80:**

```sql
SELECT grade, AVG(marks) AS avg_marks
FROM students
GROUP BY grade
HAVING AVG(marks) > 80;
```

**3. Filter groups using multiple conditions:**

```sql
SELECT city, COUNT(*) AS total_students, AVG(marks) AS avg_score
FROM students
GROUP BY city
HAVING COUNT(*) >= 2 AND AVG(marks) > 70;
```

---

## ğŸ§  Difference Between `WHERE` and `HAVING`

| Feature        | `WHERE`                | `HAVING`                 |
| -------------- | ---------------------- | ------------------------ |
| Filters        | Individual rows        | Groups after aggregation |
| Aggregate use  | âŒ Can't use aggregates | âœ… Can use aggregates     |
| Execution Time | Before grouping        | After grouping           |
| Works with     | Any query              | Only with `GROUP BY`     |

---

## â— Common Mistakes

| Mistake                                        | Explanation                          | Fix                                         |
| ---------------------------------------------- | ------------------------------------ | ------------------------------------------- |
| Using `SUM()`, `AVG()` in `WHERE`              | Aggregates aren't available yet      | Move to `HAVING`                            |
| Referencing alias in `HAVING` (in some DBs)    | Not always supported                 | Use full expression (`HAVING COUNT(*) > 2`) |
| Selecting a non-grouped, non-aggregated column | SQL doesnâ€™t know which value to show | Either group it or aggregate it             |

---

## ğŸ’¡ Best Practices

* âœ… Use `WHERE` to reduce data **before grouping** (for better performance).
* âœ… Use `HAVING` to apply filters **after aggregation**.
* âœ… Use full aggregate expressions in `HAVING` (`HAVING COUNT(*) > 2`).
* âœ… Keep queries readable by using clear aliases in `SELECT`.

---

## ğŸ” Recap: Mental Model

1. **Think of `GROUP BY` as buckets**
2. **Aggregate functions** summarize each bucket
3. **`HAVING`** filters which buckets to keep

---
