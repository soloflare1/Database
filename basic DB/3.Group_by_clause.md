# âœ… SQL `GROUP BY` 
---

## ðŸ”· What is `GROUP BY`?

The `GROUP BY` clause groups **rows with the same value(s)** into **summary rows**.

Think of it like:
> â€œGroup all students by city, then calculate something per city.â€

It works **together with aggregate functions** like:
- `COUNT()`, `AVG()`, `SUM()`, `MIN()`, `MAX()`

---

## ðŸ§  Why do we need `GROUP BY`?

Because sometimes we want **aggregated insights**, not raw data.

Example questions:
- How many students are from each city?
- What is the average score per grade?
- Which cities have more than 2 students?

> `GROUP BY` turns raw data â†’ **summarized data** by category.

---

## âš™ï¸ How does `GROUP BY` work?

Letâ€™s break down the flow:

```sql
SELECT column1, AGG_FUNC(column2)
FROM table_name
WHERE condition        -- 1ï¸âƒ£ Filter rows first
GROUP BY column1       -- 2ï¸âƒ£ Make groups
HAVING condition       -- 3ï¸âƒ£ Filter groups (optional)
ORDER BY something;    -- 4ï¸âƒ£ Sort result
````

### âœ… Behind the Scenes:

1. SQL scans the table
2. Applies `WHERE` (filters rows)
3. Groups remaining rows by column(s)
4. Runs aggregates like `AVG()`, `SUM()`, `COUNT()`, etc.
5. Filters the grouped result with `HAVING` (if used)
6. Outputs one row **per group**

---

## ðŸ“Œ When to Use `GROUP BY`

| Situation                             | Use `GROUP BY`? |
| ------------------------------------- | --------------- |
| Want total/avg/count per category     | âœ… Yes           |
| Using aggregate functions in SELECT   | âœ… Yes           |
| Just filtering raw rows (no grouping) | âŒ No            |
| Need group-level filters (`HAVING`)   | âœ… Yes           |

---
## ðŸ” Example â€” Group by `city

```sql
SELECT city
FROM students
GROUP BY city;
```
---
## ðŸ” Example â€” Group by `city`, show avg marks

```sql
SELECT city, AVG(marks) AS avg_marks
FROM students
GROUP BY city;
```

ðŸ§¾ This shows average marks **per city** (not for the whole table).

---
## ðŸ”Ž Example â€” Count students per `grade`

```sql
SELECT grade, COUNT(*) AS student_count
FROM students
GROUP BY grade;
```

---

## ðŸ”’ Rule: What can go in SELECT?

You can **only** include:

* Columns listed in `GROUP BY`
* Aggregates like `SUM()`, `AVG()`, `COUNT()`

âŒ Invalid:

```sql
SELECT city, name FROM students GROUP BY city;
```

âœ… Valid:

```sql
SELECT city, COUNT(name) 
FROM students 
GROUP BY city;
```

---

## ðŸ§  Mental Model

> Think of `GROUP BY` as creating **"buckets"** (one per group).
> Then, aggregate functions are applied **inside each bucket**, and the result is **one row per bucket**.

---

## ðŸ§ª Using `HAVING` with `GROUP BY`
Counts how many students are in each city, and then only shows those cities 
where the count is greater than 2.
```sql
SELECT city, COUNT(*) AS total
FROM students
GROUP BY city
HAVING COUNT(*) > 2;
```

### Why `HAVING`?

* You **canâ€™t** use aggregate functions in `WHERE`
* So use `HAVING` to filter **after** groups are formed

---

## â— Common Mistakes

| Mistake                      | Fix it like this                     |
| ---------------------------- | ------------------------------------ |
| Selecting non-grouped column | Use an aggregate or add to GROUP BY  |
| Using aggregate in WHERE     | Use HAVING instead                   |
| Wrong clause order           | GROUP BY â†’ then HAVING â†’ then SELECT |

---

## ðŸ“ Summary Table

| Clause     | Filters What?          | Can use Aggregates? |
| ---------- | ---------------------- | ------------------- |
| `WHERE`    | Individual rows        | âŒ No                |
| `GROUP BY` | Makes groups           | âœ… Yes               |
| `HAVING`   | Filters grouped result | âœ… Yes               |

---

## ðŸ§ª Examples for Practice

### 1. Count how many students per city:

```sql
SELECT city, COUNT(*) 
FROM students 
GROUP BY city;
```

### 2. Show cities where avg(marks) > 80:

```sql
SELECT city, AVG(marks) AS avg_marks
FROM students
GROUP BY city
HAVING AVG(marks) > 80;
```
> Even if alias **might** work in `HAVING`, **always prefer the full expression** (like `COUNT(*)`) to stay portable and clear.


### 3. Find grades with at least 2 students:

```sql
SELECT grade, COUNT(*) 
FROM students 
GROUP BY grade 
HAVING COUNT(*) >= 2;
```
---

### 1. **Multiple Column Grouping**
   Example:

   ```sql
   SELECT city, grade, COUNT(*) 
   FROM students 
   GROUP BY city, grade;
   ```

   â†’ Grouping by *both* city **and** grade.

