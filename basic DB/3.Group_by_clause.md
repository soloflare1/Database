# ✅ SQL `GROUP BY` 
---

## 🔷 What is `GROUP BY`?

The `GROUP BY` clause groups **rows with the same value(s)** into **summary rows**.

Think of it like:
> “Group all students by city, then calculate something per city.”

It works **together with aggregate functions** like:
- `COUNT()`, `AVG()`, `SUM()`, `MIN()`, `MAX()`

---

## 🧠 Why do we need `GROUP BY`?

Because sometimes we want **aggregated insights**, not raw data.

Example questions:
- How many students are from each city?
- What is the average score per grade?
- Which cities have more than 2 students?

> `GROUP BY` turns raw data → **summarized data** by category.

---

## ⚙️ How does `GROUP BY` work?

Let’s break down the flow:

```sql
SELECT column1, AGG_FUNC(column2)
FROM table_name
WHERE condition        -- 1️⃣ Filter rows first
GROUP BY column1       -- 2️⃣ Make groups
HAVING condition       -- 3️⃣ Filter groups (optional)
ORDER BY something;    -- 4️⃣ Sort result
````

### ✅ Behind the Scenes:

1. SQL scans the table
2. Applies `WHERE` (filters rows)
3. Groups remaining rows by column(s)
4. Runs aggregates like `AVG()`, `SUM()`, `COUNT()`, etc.
5. Filters the grouped result with `HAVING` (if used)
6. Outputs one row **per group**

---

## 📌 When to Use `GROUP BY`

| Situation                             | Use `GROUP BY`? |
| ------------------------------------- | --------------- |
| Want total/avg/count per category     | ✅ Yes           |
| Using aggregate functions in SELECT   | ✅ Yes           |
| Just filtering raw rows (no grouping) | ❌ No            |
| Need group-level filters (`HAVING`)   | ✅ Yes           |

---
## 🔍 Example — Group by `city

```sql
SELECT city
FROM students
GROUP BY city;
```
---
## 🔍 Example — Group by `city`, show avg marks

```sql
SELECT city, AVG(marks) AS avg_marks
FROM students
GROUP BY city;
```

🧾 This shows average marks **per city** (not for the whole table).

---
## 🔎 Example — Count students per `grade`

```sql
SELECT grade, COUNT(*) AS student_count
FROM students
GROUP BY grade;
```

---

## 🔒 Rule: What can go in SELECT?

You can **only** include:

* Columns listed in `GROUP BY`
* Aggregates like `SUM()`, `AVG()`, `COUNT()`

❌ Invalid:

```sql
SELECT city, name FROM students GROUP BY city;
```

✅ Valid:

```sql
SELECT city, COUNT(name) 
FROM students 
GROUP BY city;
```

---

## 🧠 Mental Model

> Think of `GROUP BY` as creating **"buckets"** (one per group).
> Then, aggregate functions are applied **inside each bucket**, and the result is **one row per bucket**.

---

## 🧪 Using `HAVING` with `GROUP BY`
Counts how many students are in each city, and then only shows those cities 
where the count is greater than 2.
```sql
SELECT city, COUNT(*) AS total
FROM students
GROUP BY city
HAVING COUNT(*) > 2;
```

### Why `HAVING`?

* You **can’t** use aggregate functions in `WHERE`
* So use `HAVING` to filter **after** groups are formed

---

## ❗ Common Mistakes

| Mistake                      | Fix it like this                     |
| ---------------------------- | ------------------------------------ |
| Selecting non-grouped column | Use an aggregate or add to GROUP BY  |
| Using aggregate in WHERE     | Use HAVING instead                   |
| Wrong clause order           | GROUP BY → then HAVING → then SELECT |

---

## 📝 Summary Table

| Clause     | Filters What?          | Can use Aggregates? |
| ---------- | ---------------------- | ------------------- |
| `WHERE`    | Individual rows        | ❌ No                |
| `GROUP BY` | Makes groups           | ✅ Yes               |
| `HAVING`   | Filters grouped result | ✅ Yes               |

---

## 🧪 Examples for Practice

### 1. Count how many students per city:

```sql
SELECT city, COUNT(*) 
FROM students 
GROUP BY city;
```

### 2. Show cities where avg(marks) > 80:

```sql
SELECT city, AVG(marks) AS avg_marks
FROM students
GROUP BY city
HAVING AVG(marks) > 80;
```
> Even if alias **might** work in `HAVING`, **always prefer the full expression** (like `COUNT(*)`) to stay portable and clear.


### 3. Find grades with at least 2 students:

```sql
SELECT grade, COUNT(*) 
FROM students 
GROUP BY grade 
HAVING COUNT(*) >= 2;
```
---

### 1. **Multiple Column Grouping**
   Example:

   ```sql
   SELECT city, grade, COUNT(*) 
   FROM students 
   GROUP BY city, grade;
   ```

   → Grouping by *both* city **and** grade.

